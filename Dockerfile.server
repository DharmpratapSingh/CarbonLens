# ClimateGPT MCP Server
# Python 3.11 is required for optimal compatibility with DuckDB, GeoPandas, and NumPy 2.x
FROM python:3.14-slim

WORKDIR /app

# Install system dependencies for geospatial processing
RUN apt-get update && apt-get install -y --no-install-recommends \
    libgeos-dev \
    libproj-dev \
    libspatialindex-dev \
    && rm -rf /var/lib/apt/lists/*

# Install UV package manager
RUN pip install --no-cache-dir uv

# Copy dependency files
COPY pyproject.toml uv.lock* ./

# Install Python dependencies using UV (faster and more reliable)
RUN uv pip install --system --no-cache -r pyproject.toml

# Fallback: Also copy requirements.txt for compatibility
COPY requirements.txt* ./
RUN if [ -f requirements.txt ]; then uv pip install --system --no-cache -r requirements.txt; fi

# Copy application code
COPY . .

# Expose MCP server port
EXPOSE 8010

# Run the MCP HTTP bridge (which spawns the stdio server)
CMD ["python", "mcp_http_bridge.py"]
